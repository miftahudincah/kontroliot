<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>IoT Control Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #121212;
      color: #ffffff;
    }

    .container {
      max-width: 420px;
      margin: auto;
      padding: 20px;
    }

    h2 {
      text-align: center;
      color: #ffffff;
    }

    /* LOGIN */
    #loginBox {
      margin-top: 90px;
      background: #1e1e1e;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.6);
    }

    input {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      margin-top: 12px;
      background: #2a2a2a;
      color: #ffffff;
      border: none;
      border-radius: 8px;
      outline: none;
    }

    input::placeholder {
      color: #aaaaaa;
    }

    button {
      width: 100%;
      padding: 14px;
      margin-top: 14px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #2979ff;
      color: #ffffff;
    }

    button:hover {
      background: #1c5fd4;
    }

    #loginMsg {
      margin-top: 12px;
      text-align: center;
      color: #ff5252;
    }

    /* CONTROL PANEL */
    #controlBox {
      display: none;
      margin-top: 20px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
      margin-top: 20px;
    }

    .btn {
      padding: 28px;
      font-size: 18px;
      border-radius: 12px;
      border: none;
      color: #ffffff;
      cursor: pointer;
      transition: transform 0.1s;
    }

    .btn:active {
      transform: scale(0.96);
    }

    .green {
      background: #2e7d32;
    }

    .red {
      background: #c62828;
    }
  </style>
</head>

<body>
<div class="container">

  <!-- LOGIN -->
  <div id="loginBox">
    <h2>Masukkan Key</h2>
    <input type="text" id="keyInput" placeholder="contoh: 3dfhsul98">
    <button onclick="login()">LANJUT</button>
    <div id="loginMsg"></div>
  </div>

  <!-- CONTROL PANEL -->
  <div id="controlBox">
    <h2>Control Panel</h2>
    <div class="grid" id="buttons"></div>
  </div>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
  /* FIREBASE CONFIG */
  firebase.initializeApp({
    databaseURL: "https://iotmicro-48251-default-rtdb.firebaseio.com"
  });

  const db = firebase.database();
  let userKey = "";

  /* LOGIN */
  function login() {
    const input = document.getElementById("keyInput");
    const msg   = document.getElementById("loginMsg");
    const key   = input.value.trim();

    msg.innerText = "";

    if (!key) {
      msg.innerText = "Key belum diisi";
      return;
    }

    db.ref("key/" + key).once("value", snap => {
      if (snap.exists()) {
        userKey = key;

        /* kosongkan input setelah login */
        input.value = "";

        document.getElementById("loginBox").style.display = "none";
        document.getElementById("controlBox").style.display = "block";

        initButtons();
        listenFirebase();
      } else {
        msg.innerText = "Key tidak valid";
      }
    });
  }

  /* INIT BUTTON */
  function initButtons() {
    const box = document.getElementById("buttons");
    box.innerHTML = "";

    for (let i = 1; i <= 8; i++) {
      const btn = document.createElement("button");
      btn.id = "btn" + i;
      btn.className = "btn green";
      btn.innerText = "SAKLAR " + i;
      btn.onclick = () => toggleSaklar(i);
      box.appendChild(btn);
    }
  }

  /* LISTEN FIREBASE */
  function listenFirebase() {
    db.ref("key/" + userKey).on("value", snap => {
      const data = snap.val();
      if (!data) return;

      for (let i = 1; i <= 8; i++) {
        const btn = document.getElementById("btn" + i);
        if (!btn) continue;

        const val = data["saklar" + i] || 0;
        btn.className = val === 1 ? "btn red" : "btn green";
      }
    });
  }

  /* TOGGLE SAKLAR */
  function toggleSaklar(n) {
    const ref = db.ref("key/" + userKey + "/saklar" + n);
    ref.once("value", snap => {
      const val = snap.val() || 0;
      ref.set(val === 1 ? 0 : 1);
    });
  }
</script>

</body>
</html>
